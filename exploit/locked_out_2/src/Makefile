TARGET = locked_out
LIBS =
CROSS =
CC = $(CROSS)gcc
CFLAGS = -Wall -Werror -fno-stack-protector -std=c99 -static -Wno-deprecated-declarations -Wl,-Ttext-segment,0x40000000
ROT ?= 5
PASSWORD ?= $(shell cat password.txt)
FLAG ?= $(shell cat flag.txt)
E_PASSWORD ?= $(shell ./rot.py $(ROT) < password.txt)
E_FLAG ?= $(shell ./rot.py $(ROT) < flag.txt)

.PHONY: default all clean

default: $(TARGET)
all: default

$(TARGET).o: $(TARGET).c
	$(CC) -DROT=$(ROT) -DE_PASSWORD=\"$(E_PASSWORD)\" -DE_FLAG=\"$(E_FLAG)\" $(CFLAGS) -c $< -o $@
$(TARGET): $(TARGET).o
	$(CC) $< $(CFLAGS) $(LIBS) -o $@

clean:
	-rm -f *.o
	-rm -f $(TARGET)
